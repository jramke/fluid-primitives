const e=new WeakMap;function t(t,n){t&&(e.set(t,{machine:n,fields:new Map,expectedFieldCount:t.querySelectorAll(`[data-scope="field"][data-part="root"]`).length||0}),t.dispatchEvent(new CustomEvent(`fluid-primitives:form:registered`,{bubbles:!0})))}function n(t,n){if(!t)return;let i=r(t);if(!i)return;let a=e=>{e.fields.set(n.prop(`name`),n),e.fields.size===e.expectedFieldCount&&e.machine.notify()},o=()=>{let t=e.get(i);t&&(a(t),i.removeEventListener(`fluid-primitives:form:registered`,o))},s=e.get(i);s?a(s):i.addEventListener(`fluid-primitives:form:registered`,o)}function r(e){if(!e)return null;if(e instanceof HTMLFormElement)return e;let t=e.closest(`form`);return t}function i(t){if(!t)return;let n=r(t);if(n)return e.get(n)?.machine}function a(t){if(!t)return new Map;let n=r(t);if(!n)return new Map;let i=e.get(n);return i?i.fields:new Map}export{a as getFieldMachinesFor,i as getFormMachineFor,n as registerFieldMachineForForm,t as registerFormMachine};