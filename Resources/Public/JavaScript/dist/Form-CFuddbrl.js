import{Component as e,Machine as t,normalizeProps as n}from"./Client-ClhqcFHq.js";import{registerFormMachine as r}from"./form.registry-BEubiwYA.js";import{createMachine as i}from"@zag-js/core";import{createAnatomy as a}from"@zag-js/anatomy";import{dataAttr as o}from"@zag-js/dom-query";const s=a(`form`).parts(`form`),c=s.build(),l=e=>e.ids?.form??`form:${e.id}:form`,u=e=>e.getById(l(e));var d;function f(e){return{lang:e?.lang??d?.lang,message:e?.message,abortEarly:e?.abortEarly??d?.abortEarly,abortPipeEarly:e?.abortPipeEarly??d?.abortPipeEarly}}var p;function m(e){return p?.get(e)}var h;function g(e){return h?.get(e)}var _;function v(e,t){return _?.get(e)?.get(t)}function y(e){let t=typeof e;return t===`string`?`"${e}"`:t===`number`||t===`bigint`||t===`boolean`?`${e}`:t===`object`||t===`function`?(e&&Object.getPrototypeOf(e)?.constructor?.name)??`null`:t}function b(e,t,n,r,i){let a=i&&`input`in i?i.input:n.value,o=i?.expected??e.expects??null,s=i?.received??y(a),c={kind:e.kind,type:e.type,input:a,expected:o,received:s,message:`Invalid ${t}: ${o?`Expected ${o} but r`:`R`}eceived ${s}`,requirement:e.requirement,path:i?.path,issues:i?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},l=e.kind===`schema`,u=i?.message??e.message??v(e.reference,c.lang)??(l?g(c.lang):null)??r.message??m(c.lang);u!==void 0&&(c.message=typeof u==`function`?u(c):u),l&&(n.typed=!1),n.issues?n.issues.push(c):n.issues=[c]}function x(e){return{version:1,vendor:`valibot`,validate(t){return e[`~run`]({value:t},f())}}}function S(e,t){return{kind:`validation`,type:`min_length`,reference:S,async:!1,expects:`>=${e}`,requirement:e,message:t,"~run"(e,t){return e.typed&&e.value.length<this.requirement&&b(this,`length`,e,t,{received:`${e.value.length}`}),e}}}function C(e,t){return{kind:`validation`,type:`value`,reference:C,async:!1,expects:e instanceof Date?e.toJSON():y(e),requirement:e,message:t,"~run"(e,t){return e.typed&&!(this.requirement<=e.value&&this.requirement>=e.value)&&b(this,`value`,e,t,{received:e.value instanceof Date?e.value.toJSON():y(e.value)}),e}}}function w(e,t,n){return typeof e.fallback==`function`?e.fallback(t,n):e.fallback}function T(e,t,n){return typeof e.default==`function`?e.default(t,n):e.default}function E(e,t){return{kind:`schema`,type:`object`,reference:E,expects:`Object`,async:!1,entries:e,message:t,get"~standard"(){return x(this)},"~run"(e,t){let n=e.value;if(n&&typeof n==`object`)for(let r in e.typed=!0,e.value={},this.entries){let i=this.entries[r];if(r in n||(i.type===`exact_optional`||i.type===`optional`||i.type===`nullish`)&&i.default!==void 0){let a=r in n?n[r]:T(i),o=i[`~run`]({value:a},t);if(o.issues){let i={type:`object`,origin:`value`,input:n,key:r,value:a};for(let t of o.issues)t.path?t.path.unshift(i):t.path=[i],e.issues?.push(t);if(e.issues||=o.issues,t.abortEarly){e.typed=!1;break}}o.typed||(e.typed=!1),e.value[r]=o.value}else if(i.fallback!==void 0)e.value[r]=w(i);else if(i.type!==`exact_optional`&&i.type!==`optional`&&i.type!==`nullish`&&(b(this,`key`,e,t,{input:void 0,expected:`"${r}"`,path:[{type:`object`,origin:`key`,input:n,key:r,value:n[r]}]}),t.abortEarly))break}else b(this,`type`,e,t);return e}}}function D(e){return{kind:`schema`,type:`string`,reference:D,expects:`string`,async:!1,message:e,get"~standard"(){return x(this)},"~run"(e,t){return typeof e.value==`string`?e.typed=!0:b(this,`type`,e,t),e}}}function O(...e){return{...e[0],pipe:e,get"~standard"(){return x(this)},"~run"(t,n){for(let r of e)if(r.kind!==`metadata`){if(t.issues&&(r.kind===`schema`||r.kind===`transformation`)){t.typed=!1;break}(!t.issues||!n.abortEarly&&!n.abortPipeEarly)&&(t=r[`~run`](t,n))}return t}}}function k(e,t,n){let r=e[`~run`]({value:t},f(n));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}function A(e){if(!e||e.length===0)return``;let t=e.map(e=>typeof e.key==`number`?String(e.key):typeof e.key==`string`?e.key:typeof e.index==`number`?String(e.index):``).filter(Boolean);return t.join(`.`)}function j(e){if(e.success)return{};let t={};for(let n of e.issues){let e=A(n.path)||(typeof n.input==`string`?n.input:``),r=n.message??`Invalid value`;t[e]||(t[e]=[]),t[e].push(r)}return t}function M(e){let t=e;if(!(!t||!(`type`in t))){if(t.type===`checkbox`){let e=t;if(e.name){let t=e.form;if(t){let n=Array.from(t.querySelectorAll(`input[type="checkbox"][name="${CSS.escape(e.name)}"]`)),r=n.filter(e=>e.checked).map(e=>e.value||`on`);return n.length===1&&!n[0].value?n[0].checked:r}}return e.checked}if(t.type===`radio`){let e=t;if(e.form&&e.name){let t=e.form.querySelector(`input[type="radio"][name="${CSS.escape(e.name)}"]:checked`);return t?t.value:``}return e.checked?e.value:``}return t instanceof HTMLSelectElement&&t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value}}function N(e){let t=new FormData(e),n={};for(let[e,r]of t.entries()){let t=n[e];t===void 0?n[e]=r:Array.isArray(t)?n[e]=[...t,r]:n[e]=[t,r]}return n}function P(e,t){let{context:n,state:r,send:i,scope:a}=e;function s(){return n.get(`values`)}function u(){return n.get(`errors`)}function d(){return n.get(`dirty`)}return{isSubmitting:r.matches(`submitting`),getValues:s,getErrors:u,getDirty:d,getFieldState(e){let t=s(),n=u(),r=d(),i=n[e]??[];return{value:t[e],errors:i,dirty:!!r[e],invalid:i.length>0}},getFormProps(){return t.element({...c.form.attrs,noValidate:o(!0),id:l(a),"data-dirty":o(Object.values(d()).some(e=>e)),"data-invalid":o(Object.values(u()).some(e=>e)),"data-submitting":o(r.matches(`submitting`)),"data-success":o(r.matches(`success`)),onSubmit:async e=>{e.preventDefault();let t=e.currentTarget,r=N(t);n.set(`values`,r),i({type:`SUBMIT`})},onReset:e=>{let t=e.currentTarget;queueMicrotask(()=>{let e=N(t);n.set(`initialValues`,e),n.set(`values`,e),n.set(`errors`,{});let r={};for(let t of Object.keys(e))r[t]=!1;n.set(`dirty`,r)}),i({type:`RESET`})},onInput:e=>{i({type:`INPUT`,detail:{target:e.target}})}})}}}const F=i({initialState(){return`ready`},context({bindable:e}){return{values:e(()=>({defaultValue:{}})),initialValues:e(()=>({defaultValue:{}})),errors:e(()=>({defaultValue:{}})),dirty:e(()=>({defaultValue:{}}))}},states:{ready:{},validating:{},submitting:{},success:{},error:{}},on:{SUBMIT:{target:`submitting`,actions:[`validateAll`]},VALIDATE:{target:`validating`,actions:[`validateAll`]},VALIDATE_SINGLE_FIELD:{target:`validating`,actions:[`validateSingleField`]},INPUT:{target:`ready`,actions:[`applyInputChange`,`maybeValidateChanged`]},RESET:{target:`ready`,actions:[`resetForm`]},ERROR:{target:`error`},SUCCESS:{target:`success`}},entry:[`handleFieldBlurs`],implementations:{actions:{validateAll({context:e,send:t,prop:n,state:r}){let i=n(`schema`),a=k(i,e.get(`values`)),o=j(a);if(e.set(`errors`,o),Object.keys(o).length>0){t({type:`ERROR`});return}let s=r.matches(`submitting`);if(!s){r.set(`ready`);return}let c=n(`onSubmit`);if(!c){t({type:`SUCCESS`});return}let l=c(e.get(`values`));l instanceof Promise?l.then(e=>{t(e?{type:`SUCCESS`}:{type:`ERROR`})}).catch(()=>{t({type:`ERROR`})}):t(l?{type:`SUCCESS`}:{type:`ERROR`})},applyInputChange({context:e,event:t}){let n=t,r=n?.detail?.target??n?.target??n?.currentTarget,i=r?.name;if(!i)return;let a=n?.detail?.value??M(r);console.log({name:i,value:a});let o={...e.get(`values`)};o[i]=a,e.set(`values`,o);let s=e.get(`initialValues`)[i],c={...e.get(`dirty`)};c[i]=JSON.stringify(o[i])!==JSON.stringify(s),e.set(`dirty`,c)},maybeValidateChanged({context:e,prop:t}){let n=!!t(`validateOnChange`);if(!n)return;let r=t(`schema`),i=k(r,e.get(`values`)),a=j(i);e.set(`errors`,a)},resetForm({context:e}){let t=e.get(`initialValues`);e.set(`values`,{...t}),e.set(`errors`,{});let n={};for(let e of Object.keys(t))n[e]=!1;e.set(`dirty`,n)},handleFieldBlurs({context:e,event:t,scope:n,prop:r,action:i}){let a=u(n);Array.from(a?.elements||[]).forEach(e=>{console.log({el:e}),e.addEventListener(`blur`,()=>{let t=r(`schema`);console.log(`blurred, we validate`,e,t),i([`validateSingleField`])})})},validateSingleField({prop:e,context:t,event:n}){let r=n?.detail?.name;if(!r)return;let i=e(`schema`);if(!i)return;let a=i?.entries[r];if(!a)return;let o=k(a,t.get(`values`)[r]),s=j(o),c=t.get(`errors`),l={...c};s&&Object.keys(s).length>0?l[r]=s[r]:delete l[r],t.set(`errors`,l)}}}});var I=class extends e{static name=`form`;initMachine(e){let n=new t(F,e);return r(this.getElement(`form`),n),n}initApi(){return P(this.machine.service,n)}render(){console.log(`render form`,{errors:this.api.getErrors(),values:this.api.getValues(),dirty:this.api.getDirty()});let e=this.getElement(`form`);e&&this.spreadProps(e,this.api.getFormProps())}};export{I as Form,S as minLength,E as object,O as pipe,D as string,C as value};